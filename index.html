<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ucenie sa Hrou</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>
                Ucenia sa hrou
            </h1>
        </header>

        <h1 style="color:green;">Hi</h1>

    </div>
    <div class="content">
        <div class="controls" style="margin-bottom:8px;">
            <label for="question-set-select">Vyber sadu otázok:</label>
            <select id="question-set-select">
                <option value="questions_set_19_8" selected>2019 - ukážka 8</option>
                <option value="questions_set_19_7">2019 - ukážka 7</option>
            </select>
        </div>
        <img src="./assets/image.png">
        <div class="point" style="top:300px;left:720px;" onclick="showTask('Kosice')"></div>
        <div class="point" style="top:200px;left:720px;" onclick="showTask('Presov')"></div>
        <div class="point" style="top:375px; left:120px;" onclick="showTask('Bratislava')"></div>
        <div class="point" style="top:52%; left:15%;" onclick="showTask('Trnava')"></div>
        <div class="point" style="top:45%; left:30%;" onclick="showTask('Trencin')"></div>
        <div class="point" style="top:60%; left:25%;" onclick="showTask('Nitra')"></div>
        <div class="point" style="top:30%; left:45%;" onclick="showTask('Zilina')"></div>
        <div class="point" style="top:50%; left:52%;" onclick="showTask('BanskaBystrica')"></div>
        <div class="footer">
            <footer>
                <p>made by spsd ke hlavna 113</p>
            </footer>
        </div>

        <div id="popup" class="popup">
            <div class="popup-content">
                <span class="close" onclick="closePopup()">&times;</span>
                <h2 id="task-title"></h2>
                <div id="popup-text" class="popup-text"></div>
                <div id="question-text"></div>
                <div id="choices"></div>
                <button id="submit-answer">Odoslať</button>
                <div id="feedback"></div>
            </div>
        </div>
        <script src="./questions_sets/questions_set_19_8.js"></script>
        <script src="./questions_sets/questions_set_19_7.js"></script>
        <script>
            let questions = {};

            function useQuestionSet(name) {
                if (window[name]) {
                    questions = window[name];
                } else {
                    questions = {};
                }
            }

            // Inicializuj vybranú hodnotu
            const selectEl = document.getElementById('question-set-select');
            if (selectEl) useQuestionSet(selectEl.value);
            if (selectEl) selectEl.addEventListener('change', e => useQuestionSet(e.target.value));
            // Aktuálne otvorené mesto (udržiava stav medzi renderom a odoslaním odpovede)
            let currentCity = null;
            function showTask(city) {
                currentCity = city;
                renderQuestion(city);
                document.getElementById("popup").style.display = "flex";
            }

            function closePopup() {
                document.getElementById("popup").style.display = "none";
                document.getElementById("choices").innerHTML = "";
                document.getElementById("feedback").innerText = "";
            }
            function renderQuestion(city) {
                const q = questions[city];
                if (!q) {
                    document.getElementById("task-title").innerText =
                        "Žiadna úloha pre mesto " + city;
                    document.getElementById("question-text").innerText = "";
                    document.getElementById("choices").innerHTML = "";
                    document.getElementById("feedback").innerText = "";
                    document.getElementById('submit-answer').style.display = 'none';
                    return;
                }
                document.getElementById("task-title").innerText =
                    "Úloha pre mesto " + city;

                document.getElementById("question-text").innerText =
                    q.question;

                document.getElementById("choices").innerHTML = "";
                document.getElementById("feedback").innerText = "";
                renderOptionalText(q);
                if (q.type === "choice") {
                    renderChoiceQuestion(q);
                }

                if (q.type === "drag") {
                    renderDragQuestion(q);
                }

                if (q.type === "fill") {
                    renderFillQuestion(q);
                }
                if (q.type === "openAnswer") {
                    renderOpenAnswerQuestion(q);
                }
            }
            function renderOptionalText(q) {
                const el = document.getElementById('popup-text');
                if (!el) return;

                if (q && q.requireText && questions.text) {
                    el.innerText = questions.text;
                    el.style.display = 'block';
                } else {
                    el.innerText = '';
                    el.style.display = 'none';
                }
            }
            function renderChoiceQuestion(q) {

                // Kontajner, kde sa zobrazia možnosti odpovede
                const container = document.getElementById("choices");

                // Tlačidlo na odoslanie odpovede
                const submitBtn = document.getElementById("submit-answer");

                // Zobrazíme tlačidlo (pri inom type otázky môže byť skryté)
                submitBtn.style.display = "inline-block";

                // Prejdeme všetky možnosti (A, B, C, D)
                for (const key in q.choices) {

                    // Dynamicky vytvárame HTML pre každú odpoveď
                    container.innerHTML += `
                    <div>
                        <!-- radio input zabezpečí, že môžeme vybrať iba jednu odpoveď -->
                        <input type="radio" name="answer" value="${key}">
                        ${key}: ${q.choices[key]}
                    </div>
                `;
                }

                // Logika po kliknutí na tlačidlo "Odoslať"
                submitBtn.onclick = function () {

                    // Nájdeme označenú odpoveď
                    const selected =
                        document.querySelector('input[name="answer"]:checked');

                    // Ak používateľ nič nevybral
                    if (!selected) {
                        document.getElementById("feedback").innerText =
                            "Vyber odpoveď!";
                        return;
                    }

                    // Porovnanie vybratej odpovede so správnou
                    document.getElementById("feedback").innerText =
                        selected.value === q.correct ? "Správne!" : "Nesprávne";
                };
            }
            function renderDragQuestion(q) {

                // Kontajner pre obsah otázky
                const container = document.getElementById("choices");

                // Skryjeme hlavné tlačidlo (použijeme vlastné)
                document.getElementById("submit-answer").style.display = "none";

                // Vytvoríme kópiu odpovedí a premiešame ich
                const answers = [...q.pairs].sort(() => Math.random() - 0.5);

                // Vytvoríme HTML štruktúru drag & drop otázky
                container.innerHTML = `
        <div class="drag-container">

            <!-- Ľavá strana – otázky (drop zóny) -->
            <div class="questions">
                ${q.pairs.map(p =>
                    `<div class="dropzone" data-answer="${p.a}">
                        ${p.q}
                    </div>`).join("")}
            </div>

            <!-- Pravá strana – odpovede (ťahateľné prvky) -->
            <div class="answers">
                ${answers.map(a =>
                        `<div class="draggable" draggable="true">
                        ${a.a}
                    </div>`).join("")}
            </div>
        </div>

        <!-- Tlačidlo na kontrolu odpovedí -->
        <button onclick="checkDragAnswers()">Odoslať</button>
    `;
            }
            /**********************************************************
             * 6️⃣ DRAG & DROP LOGIKA
             **********************************************************/

            // Spustí sa pri začatí ťahania
            document.addEventListener("dragstart", e => {
                if (e.target.classList.contains("draggable")) {
                    draggedItem = e.target;
                }
            });

            // Umožníme pustiť prvok do drop zóny
            document.addEventListener("dragover", e => {
                if (e.target.classList.contains("dropzone")) {
                    e.preventDefault();
                }
            });

            // Logika po pustení prvku
            document.addEventListener("drop", e => {
                if (e.target.classList.contains("dropzone")) {
                    e.preventDefault();

                    // Vložíme text odpovede do drop zóny
                    e.target.innerText = draggedItem.innerText;

                    // Uložíme používateľovu odpoveď
                    e.target.dataset.user = draggedItem.innerText;
                }
            });

            /**********************************************************
             * Kontrola odpovedí drag & drop
             **********************************************************/
            function checkDragAnswers() {

                // Nájdeme všetky drop zóny
                const zones = document.querySelectorAll(".dropzone");
                let correct = 0;

                // Skontrolujeme každú zónu
                zones.forEach(z => {

                    // Porovnáme odpoveď používateľa so správnou
                    if (z.dataset.user === z.dataset.answer) {
                        z.style.background = "#c8e6c9"; // zelená
                        correct++;
                    } else {
                        z.style.background = "#ffcdd2"; // červená
                    }
                });

                // Zobrazíme výsledok
                document.getElementById("feedback").innerText =
                    `Správne: ${correct} / ${zones.length}`;
            }
            function renderFillQuestion(q) {

                // Kontajner pre otázku
                const container = document.getElementById("choices");

                // Tlačidlo na odoslanie
                const submitBtn = document.getElementById("submit-answer");

                // Zobrazíme tlačidlo
                submitBtn.style.display = "inline-block";

                // Rozdelíme vetu podľa ___
                const parts = q.sentence.split("___");

                let html = "<p>";

                // Vytvoríme vetu s input políčkami
                parts.forEach((part, i) => {
                    html += part;

                    // Za každý ___ vložíme input
                    if (i < q.answers.length) {
                        html += `<input type="text" class="fill-input" data-index="${i}">`;
                    }
                });

                html += "</p>";
                container.innerHTML = html;

                // Logika po kliknutí na "Odoslať"
                submitBtn.onclick = function () {

                    // Nájdeme všetky input polia
                    const inputs = document.querySelectorAll(".fill-input");
                    let correct = true;

                    inputs.forEach((input, i) => {

                        // Porovnanie odpovede bez ohľadu na veľké/malé písmená
                        if (
                            input.value.trim().toLowerCase() !==
                            q.answers[i].toLowerCase()
                        ) {
                            correct = false;
                            input.style.background = "#ffcdd2"; // červená
                        } else {
                            input.style.background = "#c8e6c9"; // zelená
                        }
                    });

                    // Zobrazenie výsledku
                    document.getElementById("feedback").innerText =
                        correct ? "Správne!" : "Niektoré odpovede sú nesprávne.";
                };
            }
            function renderOpenAnswerQuestion(q) {
                const container = document.getElementById('choices');
                const submitBtn = document.getElementById('submit-answer');

                // Vyčisti predchádzajúci obsah
                container.innerHTML = '';
                document.getElementById('feedback').innerText = '';
                // Zobraziť tlačidlo odoslať
                submitBtn.style.display = 'inline-block';

                // Vytvoriť vstupné pole
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'open-answer-input';
                input.name = 'open-answer-input';
                input.placeholder = 'Napíšte odpoveď...';
                container.appendChild(input);

                // Logika po kliknutí na tlačidlo "Odoslať" - kontrola odpovede
                submitBtn.onclick = function () {
                    const val = input.value.trim().toLowerCase();
                    const answers = (q.answers || []).map(a => a.toLowerCase());
                    const correct = answers.includes(val);

                    if (correct) {
                        input.style.background = '#c8e6c9';
                        document.getElementById('feedback').innerText = 'Správne!';
                    } else {
                        input.style.background = '#ffcdd2';
                        document.getElementById('feedback').innerText = 'Nesprávne';
                    }
                };
            }
        </script>
</body>

</html>